## RTI FACE TSS HelloGoodbye Example

### Source Code Overview
The data type used by the example can be found in
idl/ShapeType.idl. It contains two types, ShapeType and ShapeTypeExtended.


The source in the app directory contains the main source for
the FACE application: app/ShapesExample.cpp.

There are three functions defined in this file:

  1. ``publisher_main()`` This function implements the logic for
     when the application is launched as a publisher. The example
     shows how to call various FACE TSS functions, as well as the
     calling convention for providing data samples. It publishes
     samples of type ShapeType or ShapeTypeExtended.

  2. ``subscriber_main()`` This function implements the logic for when the
     application is launched as a subscriber. The example shows how to
     call various FACE TSS functions as well as the calling convention
     for providing data samples. The subscriber subscribes to samples of type
     ShapeType or ShapeTypeExtended.

  3. main() The main function for the example.


The application source has several important headers included:

  1. #include "RTI/TSS/Base.hpp" Defines the RTI implementation of the
     FACE TSS Type-Specific Base interface.

  2. ``#include "gen/FACE/DM/RTI/ShapeType/TypedTS_Impl.hpp"`` Defines the RTI
     implementation of the FACE TSS Type-Specific Typed interface for
     the example ShapeType data type.

  3. ``#include "gen/FACE/DM/RTI/GoodbyeWorld/TypedTS_Impl.hpp"`` Defines the RTI
     implementation of the FACE TSS Type-Specific Typed interface for
     the example GoodbyeWorld data type.

  4. ``#include "gen/HelloGoodbye.hpp"`` This file is generated by *rtiddsgen*
     from the IDL file containing the data type definition,
     ``idl/HelloWorld.idl``.

     The header file contains the definition of the ``HelloGoodbye`` type
     for the C++ language. The application includes this header file
     because the FACE API operates on actual data types. So the
     application must use this generated definition to pass the
     expected type to the Connext TSS library, and ultimately
     the Connext DDS core.

  5. ``#include "rti_tss_impl.h"`` This file contains the RTI Connext TSS
     implementation header.

  6. ``#include "CustomConfiguration.hpp"`` This is the manually written custom
     Configuration Interface which supports changing the DDS domain that is used by
     the Connext TSS application.

In the example code, you'll see ``publisher_main()`` and ``subscriber_main()``
use the type ``HelloWorld``. Its structure is passed
to the FACE TSS API calls.

The ``app`` directory also contains the custom configuration,
``CustomConfiguration``, which inherits from the generated Configuration Interface
and is set up to allow the DDS domain to be changed with a command line argument.

The source files in the ``gen`` directory are generated by *rtiddsgen*.
They are the type-specific plugins necessary to configure and
interface with Connext DDS and Connext TSS:

  - ``HelloGoodbye.cxx (.h)`` Type definition for Connext DDS.
  - ``HelloGoodbyePlugin.cxx (.h)`` Type plugin for Connext DDS.
  - ``HelloGoodbyeSupport.cxx (.h)`` Type support for Connext DDS.
  - ``HelloGoodbye.hpp`` FACE type definition.
  - ``HelloGoodbye_TSSConfigInterface.cpp`` The default Configuration Interface which CustomConfiguration inherits from.
  - ``HelloGoodbye_TSSQosSupport.cpp`` QoS configuration per DDS entity for Connext TSS.
  - ``gen/FACE/DM/RTI/HelloWorld/TypedTS_Impl.hpp (.hpp)`` and  ``gen/FACE/DM/RTI/GoodbyeWorld/TypedTS_Impl.hpp (.hpp)`` Typed implementation of FACE TS interface.


### Build the example

``hello_goodbye`` contains a CMake script to generate the
necessary plugins and build the application.

The example can be compiled against both Pro (GeneralPurpose profile) and Micro
(GeneralPurpose and SafetyBase profiles). Out of the box, an application
compiled with the GeneralPurpose profile will not communicate with an application
compiled with the SafetyBase profile.

When invoking CMake, use the same variables as when building the RTI Connext TSS libraries:

- ``RTI_CONNEXT_TYPE``
- ``RTI_TSS_ENABLE_FACE_COMPLIANCE``
- ``CMAKE_BUILD_TYPE``

To build the example, run

     cd ${RTITSSHOME}/examples/hello_goodbye
     mkdir build
     cd build
     cmake -DRTI_CONNEXT_TYPE=<pro|micro> -DRTI_TSS_ENABLE_FACE_COMPLIANCE=GeneralPurpose -DCMAKE_BUILD_TYPE=<your_build_type> ../
     cmake --build .


Alternatively, use cmake-gui to see and configure additional CMake settings.


     cd ${RTITSSHOME}/examples/hello_goodbye
     mkdir build_gui
     cd build_gui
     cmake-gui ../
     cmake --build .


The generated plugins will be in the ``gen`` directory:

Note: By default, each run of CMake to build this example will call *rtiddsgen* to
replace, or overwrite, all files in the ``gen`` directory.

To keep the generated source from being replaced, use the
CMake command-line definition ``-DRTI_REPLACE_GEN=false``.


The resulting executable is
``../bin/${RTITSSARCH}/${RTI_CONNEXT_TYPE}/${CMAKE_BUILD_TYPE}/hello_goodbye_app``.


Note: Each build is for a single combination of Connext DDS type, FACE profile, and
CMake build type. Additional builds for different configuration combinations are
best done out-of-source (i.e., from a directory separate from the source, like the
``build`` and ``build-gui`` directories above), but note that the resulting
applications are copied to the same output directory.


### Run the example

For Connext DDS *Professional*, by default the example must be run from the
``hello_goodbye`` directory where the default ``HelloGoodbye_Qos.xml`` XML
QoS configuration file is located.  The location of this file can be configured
in ``gen/HelloGoodbye_Config.c``.

The example can be run as a publisher or a subscriber.

#### Run as a publisher
To run the example as a publisher, launch the executable with
the ``-pub`` command-line option: ::

    ./bin/${RTITSSARCH}/${RTI_CONNEXT_TYPE}/${CMAKE_BUILD_TYPE}/hello_goodbye_app -pub

There are two optional arguments:
  1. ``-num <num samples>``: the number of messages to send/receive before
     exiting.
  2. ``-id <domain_id>``: the Connext DDS domain ID to use.

The output of a publisher will look like this:

    ---------------------------------------------------------
     RTI Connext TSS HelloWorld Example (Connext DDS Micro)
    ---------------------------------------------------------
    Sending unlimited samples ...
    sending message 0
    sending message 1
    sending message 2
    sending message 3
    sending message 4
    sending message 5



#### Run as a subscriber

To run the example as a subscriber, use the ``-sub`` command-line option:

    ./bin/${RTITSSARCH}/${RTI_CONNEXT_TYPE}/${CMAKE_BUILD_TYPE}/hello_goodbye_app -sub

There are two optional arguments:
  1. ``-num <NUM SAMPLES>``: the number of messages to send/receive before
     exiting.
  2. ``-id <domain_id>``: the Connext DDS domain ID to use.

The output of a subscriber doing polling reads will look like this:

    ---------------------------------------------------------
     RTI Connext TSS HelloWorld Example (Connext DDS Micro)
    ---------------------------------------------------------
    Receiving unlimited samples ...
    received data: id[1] msg[Hello World 1]
    received data: id[0] msg[Hello World 2]
    received data: id[1] msg[Hello World 3]
    received data: id[0] msg[Hello World 4]
    received data: id[1] msg[Hello World 5]

Note that if there is no data available, the ``Receive_Message`` call will
return a ``FACE::NOT_AVAILABLE`` error (ordinal value is 2), but the example
will continue polling without shutting down.

Alternatively, to run a subscriber in callback mode,
use the ``+sub`` command-line option:

    ./bin/${RTITSSARCH}/${RTI_CONNEXT_TYPE}/${CMAKE_BUILD_TYPE}/hello_goodbye_app +sub

Its output will look like this:

    ---------------------------------------------------------
     RTI Connext TSS HelloWorld Example (Connext DDS Micro)
    ---------------------------------------------------------
    Receiving unlimited samples ...
    [FACE::DM::RTI::HelloWorld Callback_Handler called]
    [FACE::DM::RTI::HelloWorld Callback_Handler called]
    [FACE::DM::RTI::HelloWorld Callback_Handler called]

Note that the generated callback handler (in ``gen/FACE/DM/RTI/HelloWorld/TypedTS_Impl.cpp``)
prints the same default message for each received sample. The generated
callback handler(s) should be manually modified as necessary for your
application.
